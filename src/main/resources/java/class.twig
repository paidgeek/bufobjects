{%- import "/java/macros.twig" as macros -%}
{%- import "/java/types.twig" as types -%}

{%- set name = definition.name.simpleName -%}

{% set pkg = "" %}
{% for p in definition.name.path %}
  {% if (loop.revindex0 != 0) %}
    {% if (loop.index0 != 0) %}
      {% set pkg = concat(pkg, ".", lower(p)) %}
    {% else %}
      {% set pkg = concat(pkg, lower(p)) %}
    {% endif %}
  {% endif %}
{% endfor %}
{% if (pkg != "") %}
  package {{ pkg }};
{% endif %}

// Generated with https://github.com/paidgeek/bufobjects

{% set fields = definition.fields %}
{% for p in definition.parentPath -%}
  {% set fields = merge(fields, p.fields) %}
{%- endfor -%}

import {{ lower(topNamespace) }}.BufferObject;
import {{ lower(topNamespace) }}.BufferObjectBuilder;

@SuppressWarnings("all")
public class {{ name }}
{% if (definition.parent is not null) -%}
  extends {{ trim(macros.getBaseType(definition.parentDefinition)) }}
{%- else -%}
  extends BufferObject
{%- endif -%}
{

{% for field in definition.fields %}
  {%- set typeName = trim(macros.getTypeName(utils, field.type)) -%}
  protected {{ typeName }} {{ utils.toCamelCase(field.name) }};
  {%- if (utils.getClassName(field.type) == "ArrayType") %}
    public static final int {{ utils.toUpperCase(field.name) }}_LENGTH = {{ field.type.length }};
  {% endif -%}
{% endfor %}

public {{ name }}() {
  reset();
}

public {{ name }}(
{%- for field in fields -%}
  {%- set typeName = trim(macros.getTypeName(utils, field.type, 1)) -%}
  {%- set camelCase = utils.toCamelCase(field.name) -%}
  {{ typeName }} {{ camelCase }}
  {%- if (loop.revindex0 != 0) -%}
    ,
  {%- endif -%}
{%- endfor -%})
{ {%- for field in fields -%}
  {%- set camelCase = utils.toCamelCase(field.name) -%}
  {%- if (field.type.token.toString() == "s") -%}
    this.{{ camelCase }} = BufferObjectBuilder.getStringBytes({{ camelCase }});
  {% elseif(utils.getClassName(field.type) == "ArrayType" and field.type.type.token.toString() == "s") %}
    this.{{ camelCase }} = new byte[{{ utils.toUpperCase(field.name) }}_LENGTH][];
    for (int i = 0; i < {{ utils.toUpperCase(field.name) }}_LENGTH; i++) {
      this.{{ camelCase }}[i] = BufferObjectBuilder.getStringBytes({{ camelCase }}[i]);
    }
  {% elseif(utils.getClassName(field.type) == "VectorType" and field.type.type.token.toString() == "s") %}
    this.{{ camelCase }} = new java.util.ArrayList< byte[] >({{ camelCase }}.size());
    for (int i = 0; i < {{ camelCase }}.size(); i++) {
      this.{{ camelCase }}.add(BufferObjectBuilder.getStringBytes({{ camelCase }}.get(i)));
    }
  {%- else -%}
    this.{{ camelCase }} = {{ camelCase }};
  {%- endif -%}
{%- endfor -%}
}

public void init(
{%- for field in fields -%}
  {%- set typeName = trim(macros.getTypeName(utils, field.type, 1)) -%}
  {%- set camelCase = utils.toCamelCase(field.name) -%}
  {{ typeName }} {{ camelCase }}
  {%- if (loop.revindex0 != 0) -%}
    ,
  {%- endif -%}
{%- endfor -%})
{ {%- for field in fields -%}
  {%- set camelCase = utils.toCamelCase(field.name) -%}
  {%- if (field.type.token.toString() == "s") -%}
    this.{{ camelCase }} = BufferObjectBuilder.getStringBytes({{ camelCase }});
  {% elseif(utils.getClassName(field.type) == "ArrayType" and field.type.type.token.toString() == "s") %}
    this.{{ camelCase }} = new byte[{{ utils.toUpperCase(field.name) }}_LENGTH][];
    for (int i = 0; i < {{ utils.toUpperCase(field.name) }}_LENGTH; i++) {
    this.{{ camelCase }}[i] = BufferObjectBuilder.getStringBytes({{ camelCase }}[i]);
    }
  {% elseif(utils.getClassName(field.type) == "VectorType" and field.type.type.token.toString() == "s") %}
    this.{{ camelCase }} = new java.util.ArrayList< byte[] >({{ camelCase }}.size());
    for (int i = 0; i < {{ camelCase }}.size(); i++) {
    this.{{ camelCase }}.add(BufferObjectBuilder.getStringBytes({{ camelCase }}.get(i)));
    }
  {%- else -%}
    this.{{ camelCase }} = {{ camelCase }};
  {%- endif -%}
{%- endfor -%}
}

public {{ primitiveTypes[bufferObjectIdType] }} bufferObjectId() {
  return {{ trim(macros.getBufferObjectIdName(definition)) }};
}

public void reset() {
{% if (definition.parent) -%}
  super.reset();
{%- endif -%}
{% include "/java/class/reset.twig" %}
}

public {{ name }} copy() {
  {% include "/java/class/copy.twig" %}
}

public void copyTo(BufferObject obj) {
  {{ name }} dst = ({{ name }}) obj;
  {% include "/java/class/copy_to.twig" %}
}

public int size() {
  {% include "/java/class/size.twig" %}
}

public void writeTo(BufferObjectBuilder bob) {
  int needed = size();
  if(bob.getRemaining() < needed) {
    bob.growBuffer(needed);
  }
{% include "/java/class/write_to.twig" %}
}

public void readFrom(BufferObjectBuilder bob) {
{% include "/java/class/read_from.twig" %}
}

{% include "/java/class/getset.twig" %}

public static void writeDirectTo(BufferObjectBuilder bob,
{%- for field in fields -%}
  {%- set typeName = trim(macros.getTypeName(utils, field.type, 1)) -%}
  {%- set camelCase = utils.toCamelCase(field.name) -%}
  {{ typeName }} {{ camelCase }}
  {%- if (loop.revindex0 != 0) -%}
    ,
  {%- endif -%}
{%- endfor -%}) {
  {% include "/java/class/write_direct_to.twig" %}
}

public static void writeDirectIdentifiedTo(BufferObjectBuilder bob,
{%- for field in fields -%}
  {%- set typeName = trim(macros.getTypeName(utils, field.type, 1)) -%}
  {%- set camelCase = utils.toCamelCase(field.name) -%}
  {{ typeName }} {{ camelCase }}
  {%- if (loop.revindex0 != 0) -%}
    ,
  {%- endif -%}
{%- endfor -%}) {
  bob.write{{ builderTypeNames[bufferObjectIdType] }}({{ trim(macros.getBufferObjectIdName(definition)) }});
  writeDirectTo(bob, {%- for field in fields -%}
  {{ utils.toCamelCase(field.name) }}
  {%- if (loop.revindex0 != 0) -%}
    ,
  {%- endif -%}
{%- endfor -%});
}

public static Builder newBuilder() {
return new Builder();
}

{% include "/java/class/builder.twig" %}

}
